{"version":3,"file":"field/dist/scripts/field.js","mappings":"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","sources":["webpack://craft-tinymce/./src/assets/field/src/scripts/TinyMCEField.ts","webpack://craft-tinymce/external var \"jQuery\"","webpack://craft-tinymce/webpack/bootstrap","webpack://craft-tinymce/./src/assets/field/src/scripts/main.ts"],"sourcesContent":["import * as $ from 'jquery'\nimport { Editor, EditorEvent, RawEditorOptions, TinyMCE } from 'tinymce'\n\ndeclare const tinymce: TinyMCE\n\ninterface Option {\n  elementType: string\n  optionTitle: string\n  sources: string[]\n}\n\ninterface FieldSettings {\n  allSites: Array<{\n    value: string\n    text: string\n  }>\n  defaultTransform: string\n  direction: string\n  editorConfig: RawEditorOptions\n  elementId: string\n  elementSiteId: string\n  entryTypes: Record<string, string>\n  fieldId: string\n  icons: Record<string, string>\n  id: string\n  language: string\n  linkOptions: Option[]\n  locale: string\n  transforms: Array<{\n    value: string\n    text: string\n  }>\n  translations: Record<string, string>\n  volumes: string[]\n}\n\ninterface Element {\n  id: string\n  label: string\n  url: string\n}\n\ninterface LinkDialogData {\n  url: string\n  text: string\n  newTab: boolean\n  site: string\n}\n\ninterface AssetDialogData {\n  title: string\n  caption: string\n  link: string\n  newTab: boolean\n  transform: string\n}\n\ntype ShowModalFactoryType = (elementType: string, settings: object) => Function\ntype DialogConfigFunction = (title: string, items: object[], initialData: object, onChange: Function, onSubmit: Function) => any\n\nconst showModalFactory: ShowModalFactoryType = (elementType, settings = {}) => {\n  let modal: GarnishModal|undefined\n\n  return () => {\n    if (typeof modal === 'undefined') {\n      modal = Craft.createElementSelectorModal(elementType, Object.assign({\n        resizable: true,\n        multiSelect: false,\n        disableOnSelect: true\n      }, settings))\n    } else {\n      modal.show()\n    }\n  }\n}\n\nconst dialogConfig: DialogConfigFunction = (title, items, initialData, onChange, onSubmit) => {\n  return {\n    title,\n    body: {\n      type: 'panel',\n      items\n    },\n    buttons: [\n      {\n        type: 'cancel',\n        name: 'cancel',\n        text: Craft.t('tinymce', 'Cancel')\n      },\n      {\n        type: 'submit',\n        name: 'submit',\n        text: Craft.t('tinymce', 'Save'),\n        buttonType: 'primary'\n      }\n    ],\n    initialData,\n    onChange,\n    onSubmit\n  }\n}\n\nconst backdropObserver = new window.MutationObserver(() => {\n  $('.tox-dialog-wrap__backdrop')\n    .off('click.field')\n    .on('click.field', () => tinymce.activeEditor?.windowManager.close())\n})\nbackdropObserver.observe(document.body, {\n  childList: true,\n  subtree: true\n})\n\nclass TinyMCEField {\n  public editor: Editor\n\n  private _cardHtml: Record<string|number, string> = {}\n\n  private readonly _elementType = 'craft\\\\elements\\\\Entry'\n\n  constructor (private readonly _settings: FieldSettings) {\n    const settings = this._settings\n    const options = Object.assign(\n      {\n        skin: 'craft',\n        plugins: 'autoresize lists link image code',\n        content_css: false,\n\n        // Toolbars\n        menubar: false,\n        statusbar: false,\n        toolbar: 'undo redo | styles | bold italic strikethrough | bullist numlist | insertLink insertImage | hr | code',\n\n        // Context menu (the default setting, except replacing the inbuilt link/image options with our own)\n        contextmenu: 'craftLink linkchecker craftImage table spellchecker configurepermanentpen',\n\n        // Formatting\n        allow_conditional_comments: false,\n        element_format: 'xhtml',\n        entity_encoding: 'raw',\n        fix_list_elements: true,\n        // Copying in the entire default `style_formats` here to add mark option to inline submenu,\n        // because using `style_formats_merge` to merge options into submenus doesn't work\n        // Source for defaults: https://www.tiny.cloud/docs/tinymce/6/user-formatting-options/#style_formats\n        style_formats: [\n          {\n            title: 'Headings',\n            items: [\n              { title: 'Heading 1', format: 'h1' },\n              { title: 'Heading 2', format: 'h2' },\n              { title: 'Heading 3', format: 'h3' },\n              { title: 'Heading 4', format: 'h4' },\n              { title: 'Heading 5', format: 'h5' },\n              { title: 'Heading 6', format: 'h6' }\n            ]\n          },\n          {\n            title: 'Inline',\n            items: [\n              { title: 'Bold', format: 'bold' },\n              { title: 'Italic', format: 'italic' },\n              { title: 'Underline', format: 'underline' },\n              { title: 'Strikethrough', format: 'strikethrough' },\n              { title: 'Superscript', format: 'superscript' },\n              { title: 'Subscript', format: 'subscript' },\n              { title: 'Code', format: 'code' },\n              { title: 'Mark', inline: 'mark' }\n            ]\n          },\n          {\n            title: 'Blocks',\n            items: [\n              { title: 'Paragraph', format: 'p' },\n              { title: 'Blockquote', format: 'blockquote' },\n              { title: 'Div', format: 'div' },\n              { title: 'Pre', format: 'pre' }\n            ]\n          },\n          {\n            title: 'Align',\n            items: [\n              { title: 'Left', format: 'alignleft' },\n              { title: 'Center', format: 'aligncenter' },\n              { title: 'Right', format: 'alignright' },\n              { title: 'Justify', format: 'alignjustify' }\n            ]\n          }\n        ],\n\n        // Links\n        relative_urls: false,\n        remove_script_host: false,\n        anchor_top: false,\n        anchor_bottom: false,\n\n        // Auto-resize\n        autoresize_bottom_margin: 0\n      },\n      this._settings.editorConfig,\n      {\n        selector: `#${this._settings.id}`,\n        language: this._settings.language,\n        directionality: this._settings.direction,\n        add_unload_trigger: false,\n\n        extended_valid_elements: [\n          'craft-entry',\n          '#span[class]',\n          this._settings.editorConfig.extended_valid_elements ?? null\n        ].filter((str) => str !== null).join(','),\n        custom_elements: [\n          'craft-entry',\n          this._settings.editorConfig.custom_elements ?? null\n        ].filter((str) => str !== null).join(','),\n\n        setup: (editor: Editor) => {\n          this.editor = editor\n          this._setup()\n        },\n\n        init_instance_callback: (editor: Editor) => {\n          this.editor = editor\n          this._init(options)\n\n          const configInit = settings.editorConfig.init_instance_callback\n          if (typeof configInit === 'function') {\n            configInit.apply(this, arguments)\n          }\n        }\n      }\n    )\n\n    tinymce.init(options).then(() => {}, () => {})\n  }\n\n  private _commandHandleFromElementType (elementType: string): string {\n    return elementType.split('\\\\').pop()?.toLowerCase() as string\n  }\n\n  private _setup (): void {\n    const linkOptions: object[] = []\n    const elementTypeHandles: string[] = []\n    const transformOptions = [{\n      value: '',\n      text: Craft.t('tinymce', 'No transform')\n    }]\n    transformOptions.push(...this._settings.transforms)\n\n    // Replace entry cards with placeholders in textareas\n    this.editor.on('GetContent', (ev) => {\n      const content = new DOMParser().parseFromString(ev.content, 'text/html').body\n      content.querySelectorAll('.craft-entry-card').forEach((container: HTMLDivElement) => {\n        const newElement = document.createElement('craft-entry')\n        newElement.setAttribute('data-entry-id', container?.dataset.entryId ?? '')\n        newElement.textContent = ' '\n        container.replaceWith(newElement)\n      })\n      ev.content = content.innerHTML\n    })\n\n    // Replace placeholders with entry cards in iframe\n    this.editor.on('BeforeSetContent', (ev) => {\n      const editorContent = new DOMParser().parseFromString(ev.content, 'text/html').body\n      const textAreaContent = new DOMParser().parseFromString(ev.content, 'text/html').body\n      const textArea = this.editor.getElement() as HTMLTextAreaElement\n\n      editorContent.querySelectorAll('craft-entry').forEach((placeholder: HTMLTextAreaElement) => {\n        const entryId = placeholder.dataset.entryId as string\n        const newElement = document.createElement('div')\n        newElement.classList.add('craft-entry-card')\n        newElement.setAttribute('data-entry-id', entryId)\n        newElement.setAttribute('contenteditable', 'false')\n\n        if (placeholder.hasAttribute('data-card-html')) {\n          this._cardHtml[entryId] = new DOMParser()\n            .parseFromString(placeholder.dataset.cardHtml as string, 'text/html')\n            .body\n            .textContent as string\n\n          // Ensure the card HTML is removed from the textarea\n          textAreaContent.querySelector(`craft-entry[data-entry-id=\"${entryId}\"]`)\n            ?.removeAttribute('data-card-html')\n        }\n\n        newElement.innerHTML = this._cardHtml[entryId]\n        placeholder.replaceWith(newElement)\n      })\n\n      ev.content = editorContent.innerHTML\n      textArea.value = textAreaContent.innerHTML\n    })\n\n    // Load any custom icons\n    for (const [iconName, iconSvg] of Object.entries(this._settings.icons)) {\n      this.editor.ui.registry.addIcon(iconName, iconSvg)\n    }\n\n    for (const { elementType, optionTitle, sources } of this._settings.linkOptions) {\n      const elementTypeHandle = this._commandHandleFromElementType(elementType)\n      const menuItemTitle = `${elementTypeHandle}Link`\n\n      const showModal = showModalFactory(elementType, {\n        sources,\n        criteria: { locale: this._settings.locale },\n        onSelect: ([element]: [Element]) => {\n          const selectedContent = this.editor.selection.getContent()\n          this.editor.windowManager.open(this._linkDialogConfig(optionTitle, false, {\n            url: `${element.url}#${elementTypeHandle}:${element.id}@${this._settings.elementSiteId}:url`,\n            // Doing `String(element.label)` in case the element title was a number\n            text: selectedContent.length > 0 ? selectedContent : String(element.label),\n            site: this._settings.elementSiteId\n          }))\n        }\n      })\n\n      linkOptions.push({\n        type: 'menuitem',\n        text: optionTitle,\n        onAction: () => showModal()\n      })\n      this.editor.ui.registry.addMenuItem(menuItemTitle, {\n        icon: 'link',\n        text: optionTitle,\n        onAction: () => showModal()\n      })\n      elementTypeHandles.push(menuItemTitle)\n    }\n\n    linkOptions.push({\n      type: 'menuitem',\n      text: Craft.t('tinymce', 'Insert/edit link'),\n      onAction: () => this.editor.execCommand('mceLink')\n    })\n\n    // Insert link menu button, for use on the toolbar\n    this.editor.ui.registry.addMenuButton('insertLink', {\n      icon: 'link',\n      tooltip: Craft.t('tinymce', 'Link'),\n      fetch: (callback) => callback(linkOptions)\n    })\n\n    // Edit link menu item, for use on the context menu\n    const editLinkTitle = Craft.t('tinymce', 'Edit link')\n    this.editor.ui.registry.addMenuItem('editLink', {\n      icon: 'link',\n      text: editLinkTitle,\n      onAction: (_) => {\n        const element = this.editor.dom.getParent(this.editor.selection.getStart(), 'a[href]') as globalThis.Element\n        const url = element?.getAttribute('href') ?? ''\n        const siteMatch = url.match(/@([0-9]+)(:url)$/)\n        this.editor.selection.select(element)\n        this.editor.windowManager.open(this._linkDialogConfig(editLinkTitle, true, {\n          url,\n          text: element?.textContent ?? '',\n          newTab: (element?.getAttribute('target') ?? '') === '_blank',\n          site: siteMatch !== null ? siteMatch[1] : this._settings.elementSiteId\n        }))\n      }\n    })\n\n    this.editor.ui.registry.addContextMenu('craftLink', {\n      update: (element) => {\n        const parents = this.editor.dom.getParents(element, 'a')\n\n        // If we're not on a link, show the element link options\n        if (parents.length === 0) {\n          return `${elementTypeHandles.join(' ')} link`\n        }\n\n        // If we're on a Craft link, show the Craft edit link option\n        // Otherwise, show the normal TinyMCE link option\n        const onCraftLink = parents.some((parent: HTMLAnchorElement) => parent.href.endsWith(':url'))\n\n        return `${onCraftLink ? 'editLink' : 'link openlink'} unlink`\n      }\n    })\n\n    // Image button, for use on the toolbar\n    const imageButtonTitle = Craft.t('tinymce', 'Insert an image')\n    this.editor.ui.registry.addButton('insertImage', {\n      icon: 'image',\n      tooltip: imageButtonTitle,\n      onAction: () => showModalFactory('craft\\\\elements\\\\Asset', {\n        sources: this._settings.volumes,\n        transforms: this._settings.transforms.map((transform) => {\n          return {\n            handle: transform.value,\n            name: transform.text\n          }\n        }),\n        storageKey: 'RichTextFieldType.ChooseImage',\n        criteria: {\n          locale: this._settings.locale,\n          kind: 'image'\n        },\n        onSelect: ([element]: [Element], transform: string|null = null) => {\n          this.editor.windowManager.open(this._imageDialogConfig(imageButtonTitle, true, transformOptions, element, {\n            transform: transform ?? this._settings.defaultTransform\n          }))\n        }\n      })()\n    })\n\n    // Image menu item, for use on the context menu\n    const editImageTitle = Craft.t('tinymce', 'Edit image')\n    this.editor.ui.registry.addMenuItem('editImage', {\n      icon: 'image',\n      text: editImageTitle,\n      onAction: (_) => {\n        const selectionStart = this.editor.selection.getStart()\n        const img = this.editor.dom.getParent(selectionStart, 'img') as globalThis.Element\n        const a = this.editor.dom.getParent(img, 'a')\n        const figure = this.editor.dom.getParent(a ?? img, 'figure') as globalThis.Element\n        const figcaption = (a ?? img).nextSibling\n        const imgSrc = img?.getAttribute('src')\n\n        const transformMatch = imgSrc?.match(/:transform:(.+)$/) ?? []\n        const transform = transformMatch.length > 0 ? transformMatch.pop() as string : ''\n\n        const elementIdMatch = imgSrc?.match(/#asset:([0-9]+)/) as string[]\n        const elementId = elementIdMatch.pop() as string\n        const elementUrl = (transform !== '' ? imgSrc?.replace(`/_${transform}/`, '/') : imgSrc)\n          ?.replace(`:transform:${transform}`, '')\n          ?.replace(/:url$/, '')\n          ?.replace(`#asset:${elementId}`, '') as string\n\n        this.editor.selection.select(figure)\n        this.editor.windowManager.open(this._imageDialogConfig(editImageTitle, true, transformOptions, {\n          id: elementId,\n          url: elementUrl,\n          label: '' // We don't care about the element label at this point\n        }, {\n          title: img?.getAttribute('alt') ?? '',\n          caption: figcaption?.textContent ?? '',\n          link: a?.href ?? '',\n          newTab: a?.target === '_blank' ?? false,\n          transform\n        }))\n      }\n    })\n\n    this.editor.ui.registry.addContextMenu('craftImage', {\n      update: (element) => {\n        const ancestors = this.editor.dom.getParents(element, 'figure, img')\n\n        // If we're not on an image, don't show an option\n        if (ancestors.length === 0) {\n          return ''\n        }\n\n        // If we're not on a Craft asset, show the normal TinyMCE image option\n        const figure = ancestors.some((ancestor) => ancestor.tagName === 'FIGURE')\n\n        return figure ? 'editImage' : 'image'\n      }\n    })\n\n    // Create entry button, for use on the toolbar\n    this.editor.ui.registry.addMenuButton('craftentry', {\n      icon: 'craftentry',\n      tooltip: Craft.t('tinymce', 'Create an entry'),\n      fetch: (callback) => callback(Object.keys(this._settings.entryTypes).map((id) => {\n        return {\n          type: 'menuitem',\n          text: this._settings.entryTypes[id],\n          onAction: async () => {\n            try {\n              await this._createEntry(id)\n            } catch (err) {\n              Craft.cp.displayError(err.message)\n            }\n          }\n        }\n      }))\n    })\n\n    tinymce.addI18n(this._settings.language, this._settings.translations)\n  }\n\n  private _init (options: Object): void {\n    this._initFocus()\n    this._initEntryCards()\n    const contentObserver = new window.MutationObserver(() => this._initEntryCards())\n    contentObserver.observe(this.editor.getBody(), {\n      characterData: true,\n      childList: true,\n      subtree: true\n    })\n    const $form = $(this.editor.formElement as HTMLElement)\n\n    // Update the form value on any content change, and trigger a change event so drafts can autosave\n    this.editor.on('Dirty', () => {\n      this.editor.save()\n      $form.trigger('change')\n    })\n\n    // Allow use of Craft element save shortcuts\n    this.editor.addShortcut(\n      'meta+s',\n      '',\n      () => Garnish.uiLayerManager.triggerShortcut(new KeyboardEvent('keydown', {\n        shiftKey: false,\n        metaKey: true,\n        ctrlKey: true,\n        altKey: false,\n        keyCode: Garnish.S_KEY\n      }))\n    )\n    this.editor.addShortcut(\n      'shift+meta+s',\n      '',\n      () => Garnish.uiLayerManager.triggerShortcut(new KeyboardEvent('keydown', {\n        shiftKey: true,\n        metaKey: true,\n        ctrlKey: true,\n        altKey: false,\n        keyCode: Garnish.S_KEY\n      }))\n    )\n\n    // Remove the editor while switching to/from preview mode, otherwise it becomes unusable until page reload\n    const removeEditor: () => void = () => tinymce.execCommand('mceRemoveEditor', false, this._settings.id)\n    const addEditor: () => void = () => {\n      tinymce.execCommand('mceAddEditor', false, {\n        id: this._settings.id,\n        options\n      })\n      this._initFocus()\n      this._initEntryCards()\n    }\n\n    if (typeof Craft.Preview !== 'undefined') {\n      Garnish.on(Craft.Preview, 'beforeOpen beforeClose', removeEditor)\n      Garnish.on(Craft.Preview, 'open close', addEditor)\n    }\n\n    if (typeof Craft.LivePreview !== 'undefined') {\n      Garnish.on(Craft.LivePreview, 'beforeEnter beforeExit', removeEditor)\n      Garnish.on(Craft.LivePreview, 'enter exit', addEditor)\n    }\n\n    // Remove the editor while dragging Matrix, Neo, Super Table blocks - same reason as above\n    if (typeof Garnish.Drag !== 'undefined') {\n      let draggee: HTMLElement|null = null\n      Garnish.on(Garnish.Drag, 'dragStart', (event: GarnishDragEvent) => {\n        draggee = event.target?.$draggee[0]\n        if (draggee.contains(this.editor.editorContainer)) {\n          // Ensure the block height is maintained when dragged, so the empty space left by the block is consistent\n          draggee.style.height = `${draggee.offsetHeight}px`\n\n          // Ensure the cloned iframe has the same content as the original\n          // A small timeout required because the clone's content document seems to get overwritten\n          const editorIframe = this.editor.editorContainer.querySelector('iframe') as HTMLIFrameElement\n          const editorIframeHtmlEl = editorIframe.contentDocument?.querySelector('html') as HTMLElement\n          const editorIframeInnerHtml = editorIframeHtmlEl.innerHTML\n          setTimeout(\n            () => {\n              const blockClone = document.querySelector('.draghelper') as HTMLElement\n              const cloneIframe = blockClone.querySelector(`#${editorIframe.id}`) as HTMLIFrameElement\n              const cloneIframeHtmlEl = cloneIframe.contentDocument?.querySelector('html') as HTMLElement\n              cloneIframeHtmlEl.innerHTML = editorIframeInnerHtml\n            },\n            60\n          )\n\n          removeEditor()\n        } else {\n          draggee = null\n        }\n      })\n      Garnish.on(Garnish.Drag, 'dragStop', (_: GarnishDragEvent) => {\n        if (draggee !== null) {\n          // A small timeout to let the editor fully reinitialise before reverting the draggee height change\n          setTimeout(\n            () => {\n              (draggee as HTMLElement).style.height = 'auto'\n              draggee = null\n            },\n            100\n          )\n\n          addEditor()\n        }\n      })\n    }\n  }\n\n  private _initFocus (): void {\n    this.editor.on('focus', (_: EditorEvent<any>) => this.editor.container.classList.add('mce-focused'))\n    this.editor.on('blur', (_: EditorEvent<any>) => this.editor.container.classList.remove('mce-focused'))\n  }\n\n  private _initEntryCards (ids?: number[]): void {\n    this.editor.getBody()\n      .querySelectorAll<HTMLDivElement>('.craft-entry-card:not(.initialised)')\n      .forEach((card) => this._initEntryCard(card))\n  }\n\n  private _initEntryCard (card: HTMLDivElement): void {\n    const listener: () => void = async () => {\n      try {\n        await this._editEntry(card.dataset.entryId as string)\n      } catch (err) {\n        Craft.cp.displayError(err.message)\n      }\n    }\n    card.addEventListener('dblclick', listener)\n    card.classList.add('initialised')\n  }\n\n  private _linkDialogConfig (title: string, enforceReplace: boolean, initialData: object): any {\n    const selectedContent = this.editor.selection.getContent()\n    return dialogConfig(\n      title,\n      [\n        {\n          type: 'input',\n          name: 'url',\n          label: Craft.t('tinymce', 'URL'),\n          enabled: false\n        },\n        {\n          type: 'input',\n          name: 'text',\n          label: Craft.t('tinymce', 'Text')\n        },\n        {\n          type: 'checkbox',\n          name: 'newTab',\n          label: Craft.t('tinymce', 'Open in new tab?')\n        },\n        {\n          type: 'selectbox',\n          name: 'site',\n          label: Craft.t('tinymce', 'Site'),\n          items: this._settings.allSites\n        }\n      ],\n      initialData,\n      (api: any) => {\n        const data = api.getData() as LinkDialogData\n        api.setData({\n          url: data.url.replace(/@([0-9]+)(:url)$/, `@${data.site}:url`)\n        })\n      },\n      (api: any) => {\n        const data = api.getData() as LinkDialogData\n        const command = enforceReplace || selectedContent.length > 0 ? 'mceReplaceContent' : 'mceInsertContent'\n        const newContent = `<a href=\"${data.url}\" title=\"${data.text}\"${data.newTab ? ' target=\"_blank\"' : ''}>${data.text}</a>`\n\n        this.editor.execCommand(command, false, newContent)\n        api.close()\n      }\n    )\n  }\n\n  private _imageDialogConfig (\n    title: string,\n    enforceReplace: boolean,\n    transforms: object,\n    element: Element,\n    initialData: object\n  ): any {\n    const selectedContent = this.editor.selection.getContent()\n    return dialogConfig(\n      title,\n      [\n        {\n          type: 'input',\n          name: 'title',\n          label: Craft.t('tinymce', 'Title')\n        },\n        {\n          type: 'input',\n          name: 'caption',\n          label: Craft.t('tinymce', 'Caption')\n        },\n        {\n          type: 'input',\n          name: 'link',\n          label: Craft.t('tinymce', 'Link')\n        },\n        {\n          type: 'checkbox',\n          name: 'newTab',\n          label: Craft.t('tinymce', 'Open in new tab?')\n        },\n        {\n          type: 'selectbox',\n          name: 'transform',\n          label: Craft.t('tinymce', 'Transform'),\n          items: transforms\n        }\n      ],\n      initialData,\n      () => {},\n      (api: any) => {\n        const apiData = api.getData() as AssetDialogData\n        const command = enforceReplace || selectedContent.length > 0 ? 'mceReplaceContent' : 'mceInsertContent'\n        const hasTitle = apiData.title.length > 0\n        const hasCaption = apiData.caption.length > 0\n        const hasLink = apiData.link.length > 0\n        const hasTransform = apiData.transform !== ''\n        const finishIt: (url: string) => void = (url) => {\n          const content = [\n            '<figure>',\n            hasLink ? `<a href=\"${apiData.link}\"${apiData.newTab ? ' target=\"_blank\"' : ''}>` : '',\n            `<img src=\"${url}\"${hasTitle ? `alt=\"${apiData.title}\"` : ''}>`,\n            hasLink ? '</a>' : '',\n            hasCaption ? `<figcaption>${apiData.caption}</figcaption>` : ''\n          ].join('')\n\n          this.editor.execCommand(command, false, content)\n          api.close()\n        }\n\n        if (hasTransform) {\n          const data = {\n            assetId: element.id,\n            handle: apiData.transform\n          }\n          Craft.sendActionRequest('POST', 'assets/generate-transform', { data })\n            .then((response: CraftResponse) => {\n              const url = (response.data.url as string) + `#asset:${element.id}:transform:${apiData.transform}`\n              finishIt(url)\n            })\n            .catch((_: any) => {\n              Craft.cp.displayError(Craft.t('tinymce', 'There was an error generating the transform URL.'))\n            })\n        } else {\n          finishIt(`${element.url}#asset:${element.id}:url`)\n        }\n      }\n    )\n  }\n\n  private async _createEntry (typeId: string): Promise<any> {\n    const createData = {\n      elementType: this._elementType,\n      fieldId: this._settings.fieldId,\n      ownerId: this._settings.elementId,\n      siteId: this._settings.elementSiteId,\n      typeId\n    }\n    const createResponse = await Craft.sendActionRequest(\n      'POST',\n      'elements/create',\n      {\n        data: createData\n      }\n    )\n    const entryId = createResponse.data.element.id as number\n\n    return await this._editEntry(entryId, createResponse.data.element.siteId, {\n      draftId: createResponse.data.element.draftId,\n      siteId: createResponse.data.element.siteId,\n      params: {\n        fresh: 1\n      }\n    })\n  }\n\n  private async _editEntry (\n    entryId: string|number,\n    siteId?: string|number,\n    criteria?: Record<string, any>\n  ): Promise<any> {\n    criteria = {\n      ...criteria,\n      elementId: entryId ?? criteria?.elementId ?? null,\n      siteId: siteId ?? criteria?.siteId ?? null\n    }\n    Craft\n      .createElementEditor(this._elementType, criteria)\n      .on('submit', async () => {\n        const existingCard = this.editor.getBody()\n          .querySelector(`.craft-entry-card[data-entry-id=\"${entryId}\"]`)\n        const enforceReplace = existingCard !== null\n        await this._loadCardHtml(entryId, siteId, enforceReplace)\n        const selectedContent = this.editor.selection.getContent()\n        const command = existingCard !== null || selectedContent.length > 0\n          ? 'mceReplaceContent'\n          : 'mceInsertContent'\n\n        if (enforceReplace) {\n          this.editor.selection.select(existingCard)\n        }\n\n        this.editor.execCommand(command, false, `<craft-entry data-entry-id=\"${entryId}\"></craft-entry>`)\n      })\n  }\n\n  private async _loadCardHtml (\n    entryId: string|number,\n    siteId?: string|number,\n    force: boolean = false\n  ): Promise<string> {\n    if (force || typeof this._cardHtml[entryId] === 'undefined') {\n      const data = {\n        entryId,\n        siteId\n      }\n      const response = await Craft.sendActionRequest('POST', 'tinymce/input/entry-card-html', { data })\n      this._cardHtml[entryId] = response.data.cardHtml\n    }\n\n    return this._cardHtml[entryId]\n  }\n}\n\nexport { FieldSettings, TinyMCEField }\n","module.exports = jQuery;","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","import { FieldSettings, TinyMCEField } from './TinyMCEField'\n\ndeclare global {\n  interface Window {\n    TinyMCE: {\n      init: (settings: FieldSettings) => void\n      fields: () => TinyMCEField[]\n    }\n  }\n}\n\nconst fields: TinyMCEField[] = []\n\nwindow.TinyMCE = {\n  init: (settings) => {\n    fields.push(new TinyMCEField(settings))\n  },\n\n  fields: () => Array.from(fields)\n}\n"],"names":["showModalFactory","elementType","settings","modal","Craft","createElementSelectorModal","Object","assign","resizable","multiSelect","disableOnSelect","show","dialogConfig","title","items","initialData","onChange","onSubmit","body","type","buttons","name","text","t","buttonType","window","MutationObserver","$","off","on","tinymce","activeEditor","windowManager","close","observe","document","childList","subtree","TinyMCEField","constructor","_settings","_cardHtml","_elementType","this","options","skin","plugins","content_css","menubar","statusbar","toolbar","contextmenu","allow_conditional_comments","element_format","entity_encoding","fix_list_elements","style_formats","format","inline","relative_urls","remove_script_host","anchor_top","anchor_bottom","autoresize_bottom_margin","editorConfig","selector","id","language","directionality","direction","add_unload_trigger","extended_valid_elements","filter","str","join","custom_elements","setup","editor","_setup","init_instance_callback","_init","configInit","apply","arguments","init","then","_commandHandleFromElementType","split","pop","toLowerCase","linkOptions","elementTypeHandles","transformOptions","value","push","transforms","ev","content","DOMParser","parseFromString","querySelectorAll","forEach","container","newElement","createElement","setAttribute","dataset","entryId","textContent","replaceWith","innerHTML","editorContent","textAreaContent","textArea","getElement","placeholder","classList","add","hasAttribute","cardHtml","querySelector","removeAttribute","iconName","iconSvg","entries","icons","ui","registry","addIcon","optionTitle","sources","elementTypeHandle","menuItemTitle","showModal","criteria","locale","onSelect","element","selectedContent","selection","getContent","open","_linkDialogConfig","url","elementSiteId","length","String","label","site","onAction","addMenuItem","icon","execCommand","addMenuButton","tooltip","fetch","callback","editLinkTitle","_","dom","getParent","getStart","getAttribute","siteMatch","match","select","newTab","addContextMenu","update","parents","getParents","some","parent","href","endsWith","imageButtonTitle","addButton","volumes","map","transform","handle","storageKey","kind","_imageDialogConfig","defaultTransform","editImageTitle","selectionStart","img","a","figure","figcaption","nextSibling","imgSrc","transformMatch","elementId","elementUrl","replace","caption","link","target","ancestors","ancestor","tagName","keys","entryTypes","_createEntry","err","cp","displayError","message","addI18n","translations","_initFocus","_initEntryCards","getBody","characterData","$form","formElement","save","trigger","addShortcut","Garnish","uiLayerManager","triggerShortcut","KeyboardEvent","shiftKey","metaKey","ctrlKey","altKey","keyCode","S_KEY","removeEditor","addEditor","Preview","LivePreview","Drag","draggee","event","$draggee","contains","editorContainer","style","height","offsetHeight","editorIframe","editorIframeInnerHtml","contentDocument","setTimeout","remove","ids","card","_initEntryCard","addEventListener","_editEntry","enforceReplace","enabled","allSites","api","data","getData","setData","command","newContent","apiData","hasTitle","hasCaption","hasLink","hasTransform","finishIt","assetId","sendActionRequest","response","catch","typeId","createData","fieldId","ownerId","siteId","createResponse","draftId","params","fresh","createElementEditor","existingCard","_loadCardHtml","force","module","exports","jQuery","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","undefined","__webpack_modules__","call","fields","TinyMCE","Array","from"],"sourceRoot":""}